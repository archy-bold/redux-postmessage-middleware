{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap cb4c19e5bf6004ccfc90","webpack:///redux-postmessage-middleware.min.js","webpack:///./src/messaging/utils.ts","webpack:///./src/action-helpers.ts","webpack:///./src/constants.ts","webpack:///./src/index.ts","webpack:///./src/messaging/index.ts","webpack:///./src/messaging/message-dispatcher.ts","webpack:///./src/messaging/message-handler.ts","webpack:///./src/middlewares/index.ts","webpack:///./src/middlewares/message-dispatcher-middleware.ts","webpack:///./src/middlewares/message-receiver-middleware.ts"],"names":["root","factory","exports","module","define","amd","self","this","__webpack_require__","moduleId","installedModules","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","url","document","a","createElement","href","port","protocol","hostname","pathname","loc","origin","value","originFromURL","buildURL","isString","actionType","type","ACTION_PREFIX","isLocalAction","action","startsWith","remoteAction","REMOTE_ACTION","Symbol","createMessageDispatcherMiddleware","senderURL","parentURL","targetURLs","dispatch","createMessageDispatcher","window","MessageDispatcherMiddleware","createMessageReceiverMiddleware","allowedURLs","messageToActionHandler","createMessageToActionHandler","MessageReceiverMiddleware","senderOrigin","parentOrigin","targetOrigins","map","data","JSON","stringify","parent","postMessage","frames","length","frameOrigin","getOrigin","location","includes","getEventOrigin","ev","originalEvent","readAction","parse","ex","isValidAction","isValidOrigin","some","fn","next","store","addEventListener","msgAction"],"mappings":"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","file":"redux-postmessage-middleware.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"MyLib\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"MyLib\"] = factory();\n\telse\n\t\troot[\"MyLib\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap cb4c19e5bf6004ccfc90","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"MyLib\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"MyLib\"] = factory();\n\telse\n\t\troot[\"MyLib\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 3);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction parseURL(url, document) {\n    var a = document.createElement('a');\n    a.href = url;\n    var port = \"\";\n    if (a.port !== \"80\" && a.port !== \"443\") {\n        port = a.port;\n    }\n    return [a.protocol, a.hostname, port, a.pathname];\n}\nexports.parseURL = parseURL;\nfunction buildURL(protocol, hostname, port, pathname) {\n    port = !!port ? \":\" + port : '';\n    pathname = !!pathname ? pathname : '';\n    return protocol + \"//\" + hostname + port + pathname;\n}\nexports.buildURL = buildURL;\nfunction getOrigin(loc) {\n    if (!loc) {\n        return '';\n    }\n    if (!loc.origin) {\n        return loc.protocol + \"//\" + loc.hostname + (loc.port ? ':' + loc.port : '');\n    }\n    return loc.origin;\n}\nexports.getOrigin = getOrigin;\nexports.originFromURL = function (document) { return function (url) {\n    if (!url) {\n        return '';\n    }\n    var _a = parseURL(url, document), protocol = _a[0], domain = _a[1], port = _a[2];\n    return buildURL(protocol, domain, port);\n}; };\nexports.isString = function (value) { return typeof value === 'string'; };\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar constants_1 = __webpack_require__(2);\nexports.actionType = function (type) {\n    return constants_1.ACTION_PREFIX + \"/\" + type;\n};\nexports.isLocalAction = function (action) {\n    var _a = action.type, type = _a === void 0 ? '' : _a, _b = constants_1.REMOTE_ACTION, remoteAction = action[_b];\n    return (type.startsWith(constants_1.ACTION_PREFIX) && !remoteAction);\n};\n\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ACTION_PREFIX = '@redux-postmessage';\nexports.REMOTE_ACTION = Symbol('REMOTE_ACTION');\n\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar messaging_1 = __webpack_require__(4);\nvar middlewares_1 = __webpack_require__(7);\nvar action_helpers_1 = __webpack_require__(1);\nexports.actionType = action_helpers_1.actionType;\nexports.createMessageDispatcherMiddleware = function (_a) {\n    var senderURL = _a.senderURL, parentURL = _a.parentURL, targetURLs = _a.targetURLs;\n    var dispatch = messaging_1.createMessageDispatcher({\n        window: window,\n        document: document,\n        senderURL: senderURL,\n        parentURL: parentURL,\n        targetURLs: targetURLs,\n    });\n    return middlewares_1.MessageDispatcherMiddleware({ dispatch: dispatch });\n};\nexports.createMessageReceiverMiddleware = function (_a) {\n    var allowedURLs = _a.allowedURLs;\n    var messageToActionHandler = messaging_1.createMessageToActionHandler({\n        allowedURLs: allowedURLs\n    });\n    return middlewares_1.MessageReceiverMiddleware({ messageToActionHandler: messageToActionHandler });\n};\n\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar message_dispatcher_1 = __webpack_require__(5);\nexports.createMessageDispatcher = message_dispatcher_1.createMessageDispatcher;\nvar message_handler_1 = __webpack_require__(6);\nexports.createMessageToActionHandler = message_handler_1.createMessageToActionHandler;\n\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nexports.createMessageDispatcher = function (_a) {\n    var window = _a.window, document = _a.document, senderURL = _a.senderURL, _b = _a.parentURL, parentURL = _b === void 0 ? '' : _b, _c = _a.targetURLs, targetURLs = _c === void 0 ? [] : _c;\n    var senderOrigin = utils_1.originFromURL(document)(senderURL);\n    var parentOrigin = utils_1.originFromURL(document)(parentURL);\n    var targetOrigins = targetURLs.map(utils_1.originFromURL(document));\n    return function (action) {\n        var data = JSON.stringify(action);\n        if (parentOrigin) {\n            window.parent.postMessage(data, parentOrigin);\n        }\n        var frames = window.parent.frames;\n        for (var i = 0; i < frames.length; i++) {\n            try {\n                var frameOrigin = utils_1.getOrigin(frames[i].location);\n                if (frames[i] !== window && targetOrigins.includes(frameOrigin)) {\n                    frames[i].postMessage(data, senderOrigin);\n                }\n            }\n            finally {\n                continue;\n            }\n        }\n    };\n};\n\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nvar getEventOrigin = function (ev) {\n    var origin = ev.origin || ev.originalEvent.origin;\n    return origin;\n};\nvar readAction = function (ev) {\n    try {\n        var action = utils_1.isString(ev.data) ? JSON.parse(ev.data) : ev.data;\n        return action;\n    }\n    catch (ex) {\n        return { type: '' };\n    }\n};\nvar isValidAction = function (action) { return utils_1.isString(action.type); };\nexports.createMessageToActionHandler = function (_a) {\n    var allowedURLs = _a.allowedURLs;\n    var isValidOrigin = function (origin) {\n        return allowedURLs.some(function (url) { return url.includes(origin); });\n    };\n    return function (fn) { return function (ev) {\n        var origin = getEventOrigin(ev);\n        if (!isValidOrigin(origin)) {\n            return;\n        }\n        var action = readAction(ev);\n        if (!isValidAction(action)) {\n            return;\n        }\n        fn(action);\n    }; };\n};\n\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar message_dispatcher_middleware_1 = __webpack_require__(8);\nexports.MessageDispatcherMiddleware = message_dispatcher_middleware_1.MessageDispatcherMiddleware;\nvar message_receiver_middleware_1 = __webpack_require__(9);\nexports.MessageReceiverMiddleware = message_receiver_middleware_1.MessageReceiverMiddleware;\n\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar action_helpers_1 = __webpack_require__(1);\nexports.MessageDispatcherMiddleware = function (_a) {\n    var dispatch = _a.dispatch;\n    return function () { return function (next) { return function (action) {\n        if (action_helpers_1.isLocalAction(action)) {\n            dispatch(action);\n        }\n        return next(action);\n    }; }; };\n};\n\n\n/***/ }),\n/* 9 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar constants_1 = __webpack_require__(2);\nexports.MessageReceiverMiddleware = function (_a) {\n    var messageToActionHandler = _a.messageToActionHandler;\n    return function (store) {\n        window.addEventListener('message', messageToActionHandler(function (msgAction) {\n            store.dispatch(Object.defineProperty(msgAction, constants_1.REMOTE_ACTION, { value: true }));\n        }));\n        return function (next) { return function (action) { return next(action); }; };\n    };\n};\n\n\n/***/ })\n/******/ ]);\n});\n\n\n// WEBPACK FOOTER //\n// redux-postmessage-middleware.min.js","\nexport function parseURL(url: string, document: Document): string[] {\n  const a = document.createElement('a');\n  a.href = url;\n  let port = \"\";\n  // IE11 always returns port while other only return port if it's not 80 or 443.\n  if ( a.port !== \"80\" && a.port !== \"443\" ) {\n    port = a.port\n  }\n  return [a.protocol, a.hostname, port, a.pathname];\n}\n\nexport function buildURL(protocol: string, hostname: string, port?: string, pathname?: string): string {\n  port = !!port ? `:${port}`: '';\n  pathname = !!pathname ? pathname : '';\n  return `${protocol}//${hostname}${port}${pathname}`;\n}\n\nexport function getOrigin(loc: any): string {\n  if(!loc) { return ''; }\n  if(!loc.origin) {\n    return loc.protocol + \"//\" + loc.hostname + (loc.port ? ':' + loc.port: '');\n  }\n  return loc.origin;\n}\n\nexport const originFromURL = (document: Document) => (url: string): string => {\n  if (!url) { return ''; }\n  let [ protocol, domain, port ] = parseURL(url, document);\n  return buildURL(protocol, domain, port);\n};\n\nexport const isString = (value: any): boolean => typeof value === 'string';\n\n\n\n// WEBPACK FOOTER //\n// ./src/messaging/utils.ts","import { ACTION_PREFIX, REMOTE_ACTION } from './constants';\n\nexport const actionType = (type: string): string => {\n  return `${ACTION_PREFIX}/${type}`;\n}\n\nexport const isLocalAction = (action: any): boolean => {\n  const { type = '', [REMOTE_ACTION]: remoteAction } = action;\n  return (type.startsWith(ACTION_PREFIX) && !remoteAction);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/action-helpers.ts","\nexport const ACTION_PREFIX = '@redux-postmessage';\nexport const REMOTE_ACTION = Symbol('REMOTE_ACTION');\n\n\n\n// WEBPACK FOOTER //\n// ./src/constants.ts","import { createMessageDispatcher, createMessageToActionHandler } from './messaging';\nimport { MessageDispatcherMiddleware, MessageReceiverMiddleware } from './middlewares';\n// @ts-ignore\nimport { Dispatch, MiddlewareAPI } from 'redux';\n\nexport { actionType } from './action-helpers';\n\ntype MessageDispatchingOptions = {\n  senderURL: string;\n  parentURL?: string;\n  targetURLs?: string[];\n};\n\nexport const createMessageDispatcherMiddleware = <S>({ senderURL, parentURL, targetURLs }: MessageDispatchingOptions) => {\n  const dispatch = createMessageDispatcher({\n    window,\n    document,\n    senderURL,\n    parentURL,\n    targetURLs,\n  });\n\n  return MessageDispatcherMiddleware<S>({ dispatch });\n}\n\ntype MessageReceiverOptions = {\n  allowedURLs: string[];\n};\n\nexport const createMessageReceiverMiddleware = <S>({ allowedURLs }: MessageReceiverOptions) => {\n  const messageToActionHandler = createMessageToActionHandler({\n    allowedURLs\n  });\n\n  return MessageReceiverMiddleware<S>({ messageToActionHandler });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.ts","\nexport { createMessageDispatcher, MessageDispatcher } from './message-dispatcher';\nexport { createMessageToActionHandler, MessageToActionHandler } from './message-handler';\n\n\n\n// WEBPACK FOOTER //\n// ./src/messaging/index.ts","import { originFromURL, getOrigin } from './utils';\n\ntype Dependencies = {\n  window: Window;\n  document: Document;\n  senderURL: string;\n  parentURL?: string;\n  targetURLs?: string[];\n}\n\nexport type MessageDispatcher = (action: any) => void;\n\nexport const createMessageDispatcher = ({\n  window, document, senderURL, parentURL = '', targetURLs = []\n}: Dependencies): MessageDispatcher => {\n\n  const senderOrigin = originFromURL(document)(senderURL);\n  const parentOrigin = originFromURL(document)(parentURL);\n  const targetOrigins = targetURLs.map(originFromURL(document));\n\n\n  return (action: any) => {\n    const data = JSON.stringify(action);\n\n    // dispatch event parent\n    if (parentOrigin) {\n      window.parent.postMessage(data, parentOrigin);\n    }\n\n    // dispatch to all target URLs\n    const frames: any = window.parent.frames;\n    for (let i = 0; i < frames.length; i++) {\n      try {\n        const frameOrigin = getOrigin(frames[i].location);\n        if (frames[i] !== window && targetOrigins.includes(frameOrigin)) {\n          frames[i].postMessage(data, senderOrigin);\n        }\n      } finally {\n        continue;\n      }\n    }\n  };\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/messaging/message-dispatcher.ts","import { isString } from './utils';\n\nconst getEventOrigin = (ev: MessageEvent): string => {\n  const origin = ev.origin || (ev as any).originalEvent.origin;\n  return origin;\n};\n\nconst readAction = (ev: MessageEvent) => {\n  try {\n    const action: any = isString(ev.data) ? JSON.parse(ev.data) : ev.data;\n    return action;\n  } catch (ex) {\n    return { type: '' };\n  }\n};\n\nconst isValidAction = (action: any): boolean => isString(action.type);\n\ntype Dependencies = {\n  allowedURLs: string[];\n}\n\nexport type ActionHandler = (action: any) => void;\n\nexport type MessageHandler = (ev: MessageEvent) => void;\n\nexport type MessageToActionHandler = (fn: ActionHandler) => MessageHandler;\n\nexport const createMessageToActionHandler = ({ allowedURLs }: Dependencies): MessageToActionHandler  => {\n\n  const isValidOrigin = (origin: string): boolean => {\n    return allowedURLs.some(url => url.includes(origin));\n  };\n\n  return (fn: ActionHandler): MessageHandler => (ev: MessageEvent) => {\n    const origin = getEventOrigin(ev);\n    if (!isValidOrigin(origin)) { return; }\n    const action = readAction(ev);\n    if (!isValidAction(action)) { return; }\n    fn(action);\n  };\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/messaging/message-handler.ts","\nexport { MessageDispatcherMiddleware } from './message-dispatcher-middleware';\nexport { MessageReceiverMiddleware } from './message-receiver-middleware';\n\n\n\n// WEBPACK FOOTER //\n// ./src/middlewares/index.ts","import { Dispatch, MiddlewareAPI } from 'redux';\n\nimport { MessageDispatcher } from '../messaging';\nimport { isLocalAction } from '../action-helpers';\n\nexport type MessageDispatcherDependencies = {\n  dispatch: MessageDispatcher\n};\n\nexport type DispatcherMiddlewareFactory = <S>(deps: MessageDispatcherDependencies) => (api: MiddlewareAPI<S>) => (next: Dispatch<S>) => Dispatch<S>;\n\nexport const MessageDispatcherMiddleware: DispatcherMiddlewareFactory = <S>({ dispatch }: MessageDispatcherDependencies) =>\n  () => (next: Dispatch<S>) => (action: any) => {\n    if (isLocalAction(action)) {\n      dispatch(action);\n    }\n    return next(action);\n  };\n\n\n\n// WEBPACK FOOTER //\n// ./src/middlewares/message-dispatcher-middleware.ts","import { Dispatch, MiddlewareAPI } from 'redux';\n\nimport { REMOTE_ACTION } from '../constants';\nimport { MessageToActionHandler } from '../messaging';\n\nexport type MessageReceiverDependencies = {\n  messageToActionHandler: MessageToActionHandler;\n};\n\nexport type ReceiverMiddlewareFactory = <S>(deps: MessageReceiverDependencies) => (api: MiddlewareAPI<S>) => (next: Dispatch<S>) => Dispatch<S>;\n\nexport const MessageReceiverMiddleware: ReceiverMiddlewareFactory = <S>({ messageToActionHandler }: MessageReceiverDependencies) =>\n  (store: MiddlewareAPI<S>) => {\n    window.addEventListener('message', messageToActionHandler((msgAction: any) => {\n      store.dispatch(Object.defineProperty(msgAction, REMOTE_ACTION, { value: true }))\n    }));\n    return (next: Dispatch<S>) => (action: any) => next(action);\n  };\n\n\n\n// WEBPACK FOOTER //\n// ./src/middlewares/message-receiver-middleware.ts"],"sourceRoot":""}